<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Naruto vs Sasuke ‚Äî Mini Game (Full Upgrade)</title>
<style>
  :root{--bg:#0b1020;--panel:rgba(255,255,255,0.06);--accent:#ffb347}
  body{margin:0; font-family:Inter,Arial,Helvetica,sans-serif; background:var(--bg); color:#fff; overflow:hidden}
  #gameWrap{position:relative; max-width:1100px; margin:10px auto}
  canvas{background:linear-gradient(#10303b,#08202a); display:block; border:6px solid #071a22; border-radius:8px}
  #ui{position:absolute; left:12px; top:12px; background:var(--panel); padding:10px; border-radius:8px}
  #menu{position:absolute; right:12px; top:12px; background:rgba(0,0,0,0.6); padding:12px; border-radius:8px}
  .btn{display:inline-block; margin:6px; padding:8px 12px; background:#123;border-radius:6px; cursor:pointer}
  .big{font-size:18px}
  #overlay{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.6)}
  #panel{background:#041018; padding:20px; border-radius:10px; border:2px solid rgba(255,255,255,0.04); width:520px; text-align:center}
  .select{display:flex; gap:12px; justify-content:center; margin-top:12px}
  .charCard{width:200px; padding:10px; background:#081826; border-radius:8px; cursor:pointer; border:2px solid transparent}
  .charCard.selected{border-color:var(--accent); box-shadow:0 4px 12px rgba(255,180,71,0.08)}
  small{opacity:0.8}
  #saveNotice{font-size:13px; margin-top:8px; opacity:0.8}
</style>
</head>
<body>
<div id="gameWrap">
  <canvas id="canvas" width="1100" height="600"></canvas>

  <div id="ui">
    <div><strong id="charName">Naruto</strong> ‚Äî <small id="modeText">Normal</small></div>
    <div>‚ù§Ô∏è HP: <span id="hp">100</span> | üî• Chakra: <span id="chakra">100</span></div>
    <div>Boss HP: <span id="bossHP">‚Äî</span></div>
    <div style="margin-top:8px"><small>Controls: ‚Üê ‚Üí arrows, Z/X/C = jutsu, Space hold = charge, M = Menu</small></div>
  </div>

  <div id="menu">
    <div><button class="btn" id="btnPause">Pause</button><button class="btn" id="btnSave">Save</button><button class="btn" id="btnReset">Reset</button></div>
    <div style="margin-top:8px">Best Kills: <span id="bestKills">0</span></div>
  </div>
</div>

<!-- Menu Overlay -->
<div id="overlay" style="display:flex">
  <div id="panel">
    <h2> Naruto vs Sasuke ‚Äî Play </h2>
    <p>Select your character, then press Start.</p>

    <div class="select">
      <div id="cardNaruto" class="charCard selected">
        <div style="height:80px; background:linear-gradient(90deg,#ff9e3b,#ffcc80); border-radius:6px"></div>
        <h3>Naruto</h3>
        <small>Rasengan, Shadow Clone, Rasenshuriken</small>
      </div>

      <div id="cardSasuke" class="charCard">
        <div style="height:80px; background:linear-gradient(90deg,#9fb0ff,#8aa0ff); border-radius:6px"></div>
        <h3>Sasuke</h3>
        <small>Chidori, Fire Style, Lightning Blade</small>
      </div>
    </div>

    <div style="margin-top:14px">
      <button class="btn big" id="startBtn">Start Game</button>
      <button class="btn" id="loadBtn">Load Save</button>
    </div>

    <div id="saveNotice">Auto-saves to browser storage.</div>
  </div>
</div>

<script>
/* ---------------------------
  Canvas + Basic Game Loop
----------------------------*/
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let W = canvas.width, H = canvas.height;
const keys = {};
addEventListener('keydown', e => { keys[e.key] = true; if(e.key==='m' || e.key==='M') toggleOverlay() });
addEventListener('keyup', e => keys[e.key] = false);

let state = {
  running: false,
  paused: false,
  char: 'Naruto', // or Sasuke
  hp: 100,
  chakra: 100,
  chakraMax: 100,
  chakraCharge: 0,
  score: 0,
  bestKills: 0
};

/* ---------------------------
  Sprite-ish animation frames
  (We use procedural rectangles + frame indexes)
----------------------------*/
function drawPlayer(p) {
  // p: {x,y,w,h,dir,frame,color,runFrame}
  ctx.save();
  ctx.translate(p.x, p.y);
  // shadow
  ctx.fillStyle = 'rgba(0,0,0,0.25)';
  ctx.fillRect(-4, p.h - 6, p.w + 8, 8);
  // body (animated)
  const base = p.color;
  const frameShift = (p.runFrame % 4) * 2;
  ctx.fillStyle = base;
  ctx.fillRect(0, 0 - frameShift*0.2, p.w, p.h);
  // helmet / hair indicator
  ctx.fillStyle = 'rgba(255,255,255,0.08)';
  ctx.fillRect(6, 6 - frameShift*0.1, p.w - 12, 18);
  ctx.restore();
}

/* ---------------------------
  Characters definition
----------------------------*/
const chars = {
  Naruto: {
    color: '#ff9e3b',
    jutsus: {
      primary: {key:'z', name:'Rasengan', cost:20, damage:30, anim:'orb'},
      secondary: {key:'x', name:'Shadow Clone', cost:30, damage:0, anim:'clone'},
      ultimate: {key:'c', name:'Rasenshuriken', cost:60, damage:80, anim:'spin'}
    }
  },
  Sasuke: {
    color: '#7fa3ff',
    jutsus: {
      primary: {key:'z', name:'Chidori', cost:35, damage:40, anim:'light'},
      secondary: {key:'x', name:'Fireball', cost:25, damage:35, anim:'fire'},
      ultimate: {key:'c', name:'Lightning Blade', cost:60, damage:85, anim:'blade'}
    }
  }
};

/* ---------------------------
  Entities: enemies, boss
----------------------------*/
let enemies = [];
let projectiles = [];
let clones = [];
let boss = null;
let spawnTimer = 0;
let bossSpawned = false;
let kills = 0;

/* Boss Factory */
function spawnBoss() {
  boss = {
    x: 700, y: 80, w: 220, h: 220,
    hp: 600,
    phase: 1,
    timer: 0,
    color: '#4a1f1f'
  };
  bossSpawned = true;
  state.modeText = 'Boss: Hokage Incoming';
}

/* Regular enemy factory */
function spawnEnemy() {
  const y = 380;
  enemies.push({x:1100, y, w:70, h:90, hp:80, speed:2 + Math.random()*1.6, color:'#222'});
}

/* ---------------------------
  Audio: tiny WebAudio fx
----------------------------*/
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playTone(freq, time=0.08, type='sine', gain=0.12) {
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = type; o.frequency.value = freq;
  g.gain.value = gain;
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + time);
  o.stop(audioCtx.currentTime + time + 0.02);
}

/* fx presets */
function fxJutsu() { playTone(520,0.1,'sawtooth',0.12); }
function fxHit() { playTone(220,0.06,'square',0.08); }
function fxBossRoar() { playTone(120,0.6,'sawtooth',0.18); }
function fxCharge() { playTone(320,0.12,'sine',0.06); }

/* ---------------------------
  Jutsu handlers (animations + logic)
----------------------------*/
function castJutsu(kind) {
  const cfg = chars[state.char].jutsus[kind];
  if(!cfg) return;
  if(state.chakra < cfg.cost) { flashText('Not enough Chakra'); playTone(120,0.06,'sine',0.06); return; }
  state.chakra -= cfg.cost;
  fxJutsu();

  // create projectile with anim type
  const p = {
    x: player.x + player.w,
    y: player.y + player.h/2 - 10,
    vx: 12,
    w: 18, h: 18,
    life: 120,
    damage: cfg.damage,
    anim: cfg.anim,
    owner: state.char
  };

  // Shadow Clone special (Naruto)
  if(cfg.anim === 'clone') {
    // spawn 2 clones that act as friendly AI
    for(let i=0;i<2;i++){
      clones.push({
        x: player.x + (i? -40: 40), y: player.y,
        w:50,h:80, life:600, damage:18, dir: i? -1:1, frame:0
      });
    }
    return;
  }

  // If ultimate: stronger anim
  if(cfg.anim==='spin' || cfg.anim==='blade' || cfg.anim==='light') { p.vx = 9; p.damage = cfg.damage; p.ultimate = true; }

  projectiles.push(p);
}

/* ---------------------------
  Player & rendering
----------------------------*/
let player = { x:80, y:360, w:48, h:78, speed:5, color:chars.Naruto.color, runFrame:0 };

function updatePlayer() {
  // movement
  let moving = false;
  if(keys['ArrowLeft']) { player.x -= player.speed; moving = true; }
  if(keys['ArrowRight']) { player.x += player.speed; moving = true; }
  player.x = Math.max(10, Math.min(980 - player.w, player.x));

  // running frame animation
  if(moving) player.runFrame++; else player.runFrame = 0;

  // charging chakra (hold space)
  if(keys[' ']) {
    // increase charge slowly while holding, at cost of small move freeze
    player.speed = 3;
    state.chakraCharge += 0.8;
    if(state.chakraCharge > 60) state.chakraCharge = 60;
    fxCharge();
  } else {
    player.speed = 5;
    if(state.chakraCharge > 0) {
      // on release convert charge to chakra (bonus)
      const bonus = Math.floor(state.chakraCharge/3);
      state.chakra = Math.min(state.chakraMax, state.chakra + bonus);
      state.chakraCharge = 0;
      // small ring effect
      for(let i=0;i<8;i++) projectiles.push({x:player.x + player.w/2, y:player.y + player.h/2, vx: (i-4)*1.4, w:6,h:6, life:60, damage:0, anim:'chargeRing'});
      playTone(660,0.06,'triangle',0.08);
    }
  }

  // limit chakra passive regen
  if(!keys[' ']) {
    state.chakra += 0.016; if(state.chakra > state.chakraMax) state.chakra = state.chakraMax;
  }
}

/* ---------------------------
  Update world
----------------------------*/
function update(dt=1/60) {
  if(!state.running || state.paused) return;

  updatePlayer();

  // spawn enemies periodically (unless boss active)
  if(!bossSpawned) {
    spawnTimer += 1;
    if(spawnTimer > 90) { spawnEnemy(); spawnTimer = 0; }
  } else {
    // boss behavior
    boss.timer++;
    if(boss.timer % 120 === 0) {
      // fire mini projectiles at player
      const bx = boss.x, by = boss.y + boss.h/2;
      projectiles.push({x:bx-20, y:by, vx:-6, w:18,h:18, life:200, damage:20, anim:'bossBolt'});
    }
    // boss phase change
    if(boss.hp < 400 && boss.phase===1) { boss.phase=2; fxBossRoar(); }
    if(boss.hp < 200 && boss.phase===2) { boss.phase=3; fxBossRoar(); }
  }

  // move enemies
  for(let i=enemies.length-1;i>=0;i--){
    const e = enemies[i];
    e.x -= e.speed;
    if(e.x < -200) enemies.splice(i,1);
  }

  // move clones (friendly)
  for(let i=clones.length-1;i>=0;i--){
    const c = clones[i];
    c.x += c.dir*3;
    c.life--;
    c.frame++;
    if(c.life<=0) clones.splice(i,1);
  }

  // move projectiles & lifetime
  for(let i=projectiles.length-1;i>=0;i--){
    const p = projectiles[i];
    p.x += (p.vx || 0);
    p.life--;
    if(p.life<=0) projectiles.splice(i,1);
  }

  // collisions: projectiles vs enemies
  for(let i=projectiles.length-1;i>=0;i--){
    const p = projectiles[i];
    // hit enemies
    for(let j=enemies.length-1;j>=0;j--){
      const e = enemies[j];
      if(rectHit(p.x,p.y,p.w,p.h || p.w,e.x,e.y,e.w,e.h)) {
        if(p.damage>0) e.hp -= p.damage;
        // explode effect
        projectiles.splice(i,1); fxHit(); break;
      }
    }
  }

  // projectiles vs boss
  if(boss) {
    for(let i=projectiles.length-1;i>=0;i--){
      const p = projectiles[i];
      if(rectHit(p.x,p.y,p.w,p.h || p.w,boss.x,boss.y,boss.w,boss.h)) {
        if(p.damage>0) boss.hp -= p.damage;
        projectiles.splice(i,1);
        fxHit();
      }
    }
  }

  // clones damage enemies when overlapping
  for(let i=clones.length-1;i>=0;i--){
    const c = clones[i];
    for(let j=enemies.length-1;j>=0;j--){
      const e = enemies[j];
      if(rectHit(c.x,c.y,c.w,c.h,e.x,e.y,e.w,e.h)) {
        e.hp -= c.damage;
      }
    }
    // boss collision
    if(boss && rectHit(c.x,c.y,c.w,c.h,boss.x,boss.y,boss.w,boss.h)) {
      boss.hp -= c.damage;
    }
  }

  // remove dead enemies & count kills
  for(let i=enemies.length-1;i>=0;i--){
    if(enemies[i].hp <= 0) { enemies.splice(i,1); kills++; state.score += 10; }
  }

  // boss death
  if(boss && boss.hp <= 0) {
    boss = null; bossSpawned = false; state.score += 1000; playTone(880,0.8,'sawtooth',0.18);
    // reward chakra and mark best kills
    state.chakra = Math.min(state.chakraMax, state.chakra + 60);
    state.bestKills = Math.max(state.bestKills, kills);
  }

  // enemy -> player hit detection (simple)
  for(let i=enemies.length-1;i>=0;i--){
    const e = enemies[i];
    if(rectHit(e.x,e.y,e.w,e.h, player.x,player.y,player.w,player.h)) {
      // damage and push back
      state.hp -= 0.2;
      e.x += 30;
    }
  }

  // boss attacks collide with player
  for(let i=projectiles.length-1;i>=0;i--){
    const p = projectiles[i];
    if(p.vx < 0 && rectHit(p.x,p.y,p.w,p.h, player.x,player.y,player.w,player.h)) {
      state.hp -= p.damage * 0.06;
      projectiles.splice(i,1);
    }
  }

  // player death
  if(state.hp <= 0) {
    // game over
    showOverlay('Game Over', `You were defeated. Score: ${state.score}`, true);
    state.running = false;
    saveToStorage();
  }

  // spawn boss when kills reach thresh
  if(!bossSpawned && kills >= 18) spawnBoss();

  // clamp
  state.chakra = Math.max(0, Math.min(state.chakraMax, state.chakra));
}

/* ---------------------------
  Utilities
----------------------------*/
function rectHit(x1,y1,w1,h1,x2,y2,w2,h2) {
  return x1 < x2 + w2 && x1 + w1 > x2 && y1 < y2 + h2 && y1 + h1 > y2;
}

function flashText(t) {
  // quick top message
  const old = document.getElementById('charName').textContent;
  document.getElementById('charName').textContent = t;
  setTimeout(()=>document.getElementById('charName').textContent = old, 700);
}

/* ---------------------------
  Rendering
----------------------------*/
function draw() {
  ctx.clearRect(0,0,W,H);

  // ground
  ctx.fillStyle = '#072127';
  ctx.fillRect(0,460,W,140);

  // background parallax (simple)
  ctx.fillStyle = 'rgba(255,255,255,0.02)';
  for(let i=0;i<8;i++){ ctx.fillRect((i*220 + (Date.now()%220))%W, 40 + i*10, 160, 8); }

  // boss (if present)
  if(boss) {
    ctx.fillStyle = boss.color;
    ctx.fillRect(boss.x, boss.y, boss.w, boss.h);
    // boss health bar
    const bw = 300;
    ctx.fillStyle = '#000';
    ctx.fillRect(380, 16, bw, 18);
    ctx.fillStyle = '#b22222';
    ctx.fillRect(380, 16, bw * Math.max(0, boss.hp/600), 18);
    ctx.fillStyle = '#fff'; ctx.fillText('Hokage Boss', 390, 14);
  }

  // enemies
  for(const e of enemies) {
    ctx.fillStyle = e.color;
    ctx.fillRect(e.x, e.y, e.w, e.h);
    // small hp bar
    ctx.fillStyle = 'rgba(0,0,0,0.5)'; ctx.fillRect(e.x, e.y-10, e.w, 6);
    ctx.fillStyle = '#ff5050'; ctx.fillRect(e.x, e.y-10, e.w * Math.max(0,e.hp/80), 6);
  }

  // clones (friendly)
  for(const c of clones) {
    ctx.fillStyle = '#ffdca8';
    ctx.fillRect(c.x, c.y, c.w, c.h);
  }

  // projectiles and jutsu animations
  for(const p of projectiles) {
    if(p.anim === 'orb') {
      // rasengan glowy
      drawGlow(p.x, p.y, 16 + Math.sin(Date.now()/80)*6, '#69f7ff');
    } else if(p.anim === 'fire') {
      drawGlow(p.x, p.y, 20, '#ff6b4b');
    } else if(p.anim === 'blade') {
      drawGlow(p.x, p.y, 30, '#cfe8ff');
      ctx.fillStyle = '#fff'; ctx.fillRect(p.x, p.y, p.w, p.h);
    } else if(p.anim === 'light') {
      drawGlow(p.x, p.y, 18, '#bdf4ff');
    } else if(p.anim === 'bossBolt') {
      ctx.fillStyle = '#ffd700'; ctx.fillRect(p.x, p.y, p.w, p.h);
    } else if(p.anim === 'chargeRing') {
      ctx.beginPath(); ctx.strokeStyle = '#7fffd4'; ctx.lineWidth = 2;
      ctx.arc(p.x, p.y, 6 + ((p.life%60)/6), 0,Math.PI*2); ctx.stroke();
    } else {
      ctx.fillStyle = '#88f'; ctx.fillRect(p.x,p.y,p.w,p.h);
    }
  }

  // draw player
  player.color = chars[state.char].color;
  drawPlayer(player);

  // UI numbers
  document.getElementById('hp').textContent = Math.max(0, Math.floor(state.hp));
  document.getElementById('chakra').textContent = Math.floor(state.chakra);
  document.getElementById('bossHP').textContent = boss ? Math.max(0, Math.floor(boss.hp)) : '‚Äî';
  document.getElementById('modeText').textContent = boss ? `Boss Phase ${boss.phase}` : 'Normal';
  document.getElementById('bestKills').textContent = state.bestKills;

  // small HUD: chakra charge gauge
  if(state.chakraCharge > 0) {
    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.fillRect(10, 520, 140, 16);
    ctx.fillStyle = '#5af';
    ctx.fillRect(10, 520, 140 * (state.chakraCharge/60), 16);
    ctx.strokeStyle = '#fff'; ctx.strokeRect(10,520,140,16);
  }
}

/* helper glow */
function drawGlow(x,y,r,color) {
  const g = ctx.createRadialGradient(x,y,1,x,y,r);
  g.addColorStop(0, color);
  g.addColorStop(0.6, color);
  g.addColorStop(1, 'rgba(0,0,0,0)');
  ctx.fillStyle = g; ctx.beginPath();
  ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
}

/* ---------------------------
  Input events: map to jutsus
----------------------------*/
addEventListener('keydown', e => {
  if(!state.running || state.paused) return;
  if(e.key === 'z' || e.key === 'Z') castJutsu('primary');
  if(e.key === 'x' || e.key === 'X') castJutsu('secondary');
  if(e.key === 'c' || e.key === 'C') castJutsu('ultimate');
});

/* ---------------------------
  Main loop
----------------------------*/
let last = performance.now();
function loop(ts) {
  const dt = (ts - last)/1000;
  last = ts;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ---------------------------
  Menu / Overlay logic + Save
----------------------------*/
const overlay = document.getElementById('overlay');
const startBtn = document.getElementById('startBtn');
const loadBtn = document.getElementById('loadBtn');
document.getElementById('cardNaruto').addEventListener('click', ()=>selectChar('Naruto'));
document.getElementById('cardSasuke').addEventListener('click', ()=>selectChar('Sasuke'));
document.getElementById('btnPause').addEventListener('click', ()=>{ state.paused = !state.paused; document.getElementById('btnPause').textContent = state.paused ? 'Resume' : 'Pause';});
document.getElementById('btnSave').addEventListener('click', ()=>{ saveToStorage(); flashText('Saved');});
document.getElementById('btnReset').addEventListener('click', ()=>{ localStorage.removeItem('nvs_save'); location.reload(); });

function selectChar(name) {
  state.char = name;
  document.getElementById('cardNaruto').classList.toggle('selected', name==='Naruto');
  document.getElementById('cardSasuke').classList.toggle('selected', name==='Sasuke');
}

startBtn.addEventListener('click', ()=>{
  overlay.style.display = 'none';
  state.running = true; state.paused = false;
  state.hp = 100; state.chakra = 100; state.chakraCharge = 0;
  player.x = 80;
  // reset world
  enemies = []; projectiles = []; clones = []; boss = null; bossSpawned = false; kills = 0; state.score = 0;
  // set char
  selectChar(state.char);
  // small audio start
  playTone(880,0.12,'sine',0.12);
});

loadBtn.addEventListener('click', () => {
  const s = localStorage.getItem('nvs_save');
  if(!s) { flashText('No save found'); return; }
  const obj = JSON.parse(s);
  state.char = obj.char || 'Naruto';
  state.bestKills = obj.bestKills || 0;
  selectChar(state.char);
  flashText('Loaded'); overlay.style.display='none'; state.running=true;
});

/* overlay show helper */
function showOverlay(title, message, showStart=false) {
  overlay.style.display = 'flex';
  const panel = document.getElementById('panel');
  panel.innerHTML = `<h2>${title}</h2><p>${message}</p>
    <div style="margin-top:12px"><button class="btn" id="okBtn">OK</button></div>`;
  document.getElementById('okBtn').addEventListener('click', ()=>{
    panel.innerHTML = defaultPanelHtml();
    overlay.style.display = showStart ? 'flex' : 'none';
    // restore bindings
    bindPanel();
  });
}

function defaultPanelHtml(){
  return `<h2> Naruto vs Sasuke ‚Äî Play </h2>
    <p>Select your character, then press Start.</p>
    <div class="select">
      <div id="cardNaruto" class="charCard ${state.char=='Naruto'?'selected':''}">
        <div style="height:80px; background:linear-gradient(90deg,#ff9e3b,#ffcc80); border-radius:6px"></div>
        <h3>Naruto</h3>
        <small>Rasengan, Shadow Clone, Rasenshuriken</small>
      </div>
      <div id="cardSasuke" class="charCard ${state.char=='Sasuke'?'selected':''}">
        <div style="height:80px; background:linear-gradient(90deg,#9fb0ff,#8aa0ff); border-radius:6px"></div>
        <h3>Sasuke</h3>
        <small>Chidori, Fire Style, Lightning Blade</small>
      </div>
    </div>
    <div style="margin-top:14px">
      <button class="btn big" id="startBtn">Start Game</button>
      <button class="btn" id="loadBtn">Load Save</button>
    </div>
    <div id="saveNotice">Auto-saves to browser storage.</div>`;
}

function bindPanel(){
  document.getElementById('cardNaruto')?.addEventListener('click', ()=>selectChar('Naruto'));
  document.getElementById('cardSasuke')?.addEventListener('click', ()=>selectChar('Sasuke'));
  document.getElementById('startBtn')?.addEventListener('click', ()=>{
    overlay.style.display = 'none'; state.running=true; state.paused=false;
    player.x = 80; enemies=[];projectiles=[];clones=[];boss=null;bossSpawned=false;kills=0; state.hp=100; state.chakra=100;
  });
  document.getElementById('loadBtn')?.addEventListener('click', ()=>{
    const s = localStorage.getItem('nvs_save');
    if(!s) { flashText('No save found'); return; }
    const obj = JSON.parse(s);
    state.char = obj.char || 'Naruto'; state.bestKills = obj.bestKills || 0;
    selectChar(state.char); overlay.style.display='none'; state.running=true;
  });
}

/* Save/load */
function saveToStorage(){
  const obj = { char: state.char, bestKills: state.bestKills, score: state.score, chakra: state.chakra };
  localStorage.setItem('nvs_save', JSON.stringify(obj));
  document.getElementById('saveNotice').textContent = 'Saved at ' + new Date().toLocaleTimeString();
}

/* toggle overlay/menu */
function toggleOverlay() {
  if(overlay.style.display === 'flex') {
    overlay.style.display = 'none'; state.paused = false;
  } else {
    overlay.style.display = 'flex'; state.paused = true;
  }
}

/* Auto-save periodically */
setInterval(()=>{ if(state.running) saveToStorage(); }, 10000);

/* ---------------------------
  Small helper: spawn demo enemies every now & then
----------------------------*/
setInterval(()=>{ if(state.running && !bossSpawned) spawnEnemy(); }, 2500);

/* Expose castJutsu by string names for keys */
function castJutsuKeyName(name) {
  if(name==='primary') castJutsu('primary');
}

/* Initial binding */
bindPanel();
saveToStorage();

</script>
</body>
</html>         Give me the link of make and ready zip file